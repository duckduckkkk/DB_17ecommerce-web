{% extends "backstage.html" %}
{% block head %}
{{ super() }}
{% endblock head %}
{% block title %}後台資料分析{% endblock title %}
{% block content %}
<style>
#dashboard .nav-link {
    color: white; 
    background-color: rgba(16, 42, 77, 0.8); 
    border: none;
    margin-right: 5px;
    border-radius: 8px;
    transition: all 0.3s ease; 
}

#dashboard .nav-link:hover {
    background-color: rgba(25, 167, 100, 0.8); 
    transform: scale(1.05); 
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); 
}

#dashboard .nav-link.active {
    background-color: rgba(8, 114, 82, 0.8); 
    font-weight: 600; 
    transform: scale(1); 
    box-shadow: 0 6px 14px rgba(0, 0, 0, 0.35); 
}

#dashboard .nav-link {
    transition: background-color 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
}
</style>
<div class="my-3 p-3 bg-body rounded shadow-sm">
  <div id="dashboard">
    <nav>
      <div class="nav nav-tabs" id="nav-tab" role="tablist">
        <button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home" aria-selected="true">年/月銷售額分析</button>
        <button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-profile" type="button" role="tab" aria-controls="nav-profile" aria-selected="false">供應商銷售分析</button>
        <button class="nav-link" id="nav-contact-tab" data-bs-toggle="tab" data-bs-target="#nav-contact" type="button" role="tab" aria-controls="nav-contact" aria-selected="false">客戶消費排名</button>        
        <button class="nav-link" id="nav-green-tab" data-bs-toggle="tab" data-bs-target="#nav-green" type="button" role="tab" aria-controls="nav-green" aria-selected="false">綠色運送 & 二手商品分析</button>
      </div>      
    </nav>
  </div>
  <br/>
  <div class="tab-content" id="nav-tabContent">
    <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
      <center> 
        <div id="maina" class="container-fluid" style="width:1200px;height:500px"></div>
      </center>
    </div>
    <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
      <center>
        <div id="mainb" class="container-fluid" style="width: 600px;height:500px"></div>
      </center>
    </div>
    <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab">
      <center>
        <div id="mainc" class="container-fluid" style="width: 1200px;height:500px"></div>
      </center>
    </div>
    <div class="tab-pane fade" id="nav-green" role="tabpanel" aria-labelledby="nav-green-tab">
      <center>
        <div id="maing" class="container-fluid" style="width: 1200px;height:500px"></div>
      </center>
    </div>
  </div>
</div>

<script>
  // 各月總銷售額 & 訂單數量
  var chartDoma = document.getElementById('maina');
  var myCharta = echarts.init(chartDoma);
  var data = {{revenue|tojson}};
  var count = {{dataa|tojson}};
  var optiona = {
    title: { text: '各月總銷售額' },
    tooltip: {},
    xAxis: { data: ['1月','2月','3月','4月','5月','6月','7月','8月','9月','10月','11月','12月'] },
    yAxis: {},
    series: [{
      name: '總銷售額/NTD',
      type: 'bar',
      data: data,
      markPoint: {
        data: [{type: 'max', name: '銷量額最高月份'}, {type: 'min', name: '銷量額最低月份'}]
      },
      label: { show: true, position: 'top', textStyle: { fontSize: 15 } }
    }]
  };
  myCharta.setOption(optiona);

  // 各供應商銷售分析
  var datab = {{ datab|tojson | safe if datab else '[]' }};
  var pieData = datab.filter(item => item.value > 0);
  var zeroData = datab.filter(item => item.value === 0);
  var zeroColorList = ['#FF7F50','#87CEFA','#DA70D6','#32CD32','#6495ED','#FF69B4','#BA55D3','#CD5C5C'];
  zeroData = zeroData.map((item,index)=>({name:item.name,value:item.value,itemStyle:{color:zeroColorList[index % zeroColorList.length]}}));

  var chartDomb = document.getElementById('mainb');
  var myChartb = echarts.init(chartDomb);
  var optionb = {
    title:{text:'各供應商總銷貨額',left:'center',top:'5%'},
    tooltip:{trigger:'item',formatter:'{b} : {c} ({d}%)'},
    legend:{orient:'vertical',left:'left',top:'10%',itemWidth:12,itemHeight:12,formatter:function(name){return name.length>10?name.slice(0,10)+'...':name;}},
    series:[
      {name:'銷量',type:'pie',radius:['40%','60%'],center:['50%','55%'],data:pieData,label:{show:true,position:'inside',formatter:'{b}: {c}'},emphasis:{itemStyle:{shadowBlur:15,shadowOffsetX:0,shadowColor:'rgba(0,0,0,0.5)'}}},
      {name:'銷售額為0的供應商',type:'pie',radius:['20%','30%'],center:['50%','55%'],data:zeroData,label:{show:true,position:'outside',formatter:'{b}: {c}',color:'#555555'},labelLine:{show:true}}
    ]
  };
  myChartb.setOption(optionb);

  // 客戶消費總額
  var chartDomc = document.getElementById('mainc');
  var myChartc = echarts.init(chartDomc);
  var data = {{datac|tojson}};
  var nameList = {{nameList|tojson}};
  var optionc = {
    title:{text:'單一顧客消費總額',left:'center'},
    tooltip:{trigger:'axis',axisPointer:{type:'shadow'}},
    xAxis:{type:'value',name:'消費總額'},
    yAxis:{type:'category',data:nameList,inverse:true},
    series:[{name:'消費總額/NTD',type:'bar',data:data,barWidth:30,label:{show:true,position:'right'},itemStyle:{color:'#06d2daff'}}]
  };
  myChartc.setOption(optionc);

  // 第四個按鈕：綠色運送 & 二手商品分析
  var chartDomg = document.getElementById('maing');
  var myChartg = echarts.init(chartDomg);
  var greenCounts = {{green_counts|tojson}};       // Green_delivery='Y'
  var secondhandCounts = {{secondhand_counts|tojson}}; // Pstatus='二手'

  var optiong = {
    title:{text:'每月綠色運送與二手商品數量',left:'center'},
    tooltip:{trigger:'axis'},
    legend:{data:['綠色運送訂單數','二手商品數量'],top:'10%'},
    xAxis:{type:'category',data:['1月','2月','3月','4月','5月','6月','7月','8月','9月','10月','11月','12月']},
    yAxis:{type:'value'},
    series:[
      {name:'綠色運送訂單數',type:'bar',data:greenCounts},
      {name:'二手商品數量',type:'bar',data:secondhandCounts}
    ]
  };
  myChartg.setOption(optiong);

</script>
{% endblock content %}
